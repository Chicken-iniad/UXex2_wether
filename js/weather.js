const apiKey = "8322715c9dc8f38717533f00e6471070";


// APIを使用して天気情報を取得するためのURL
const apiUrl = `https://api.openweathermap.org/data/2.5/onecall?lat=35.681236&lon=139.767125&units=metric&appid=${apiKey}`;


// HTML要素の取得
const weatherContainer = document.getElementById('weather-container');

// 英語からSVGへの天気表現の変換を行う関数
function convertWeatherToSVG(weather, description) {
    switch (weather) {
        case 'Clear':
        return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><path class="st0" d="M443.3,886.5c-59.8,0-117.9-11.7-172.6-34.9c-52.8-22.3-100.2-54.3-140.9-95c-40.7-40.7-72.6-88.1-95-140.9C11.7,561.1,0,503.1,0,443.3s11.7-117.9,34.9-172.6c22.3-52.8,54.3-100.2,95-140.9s88.1-72.6,140.9-95C325.4,11.7,383.4,0,443.3,0s117.9,11.7,172.6,34.9c52.8,22.3,100.2,54.3,140.9,95c40.7,40.7,72.6,88.1,95,140.9c23.1,54.7,34.9,112.7,34.9,172.6s-11.7,117.9-34.9,172.6c-22.3,52.8-54.3,100.2-95,140.9c-40.7,40.7-88.1,72.6-140.9,95C561.1,874.8,503.1,886.5,443.3,886.5zM443.3,100C254,100,100,254,100,443.3c0,189.3,154,343.3,343.3,343.3c189.3,0,343.3-154,343.3-343.3C786.5,254,632.5,100,443.3,100z"/></svg>';
        case 'Clouds':
            if (description === 'few clouds' || description === 'scattered clouds' || description === 'broken clouds') {
                return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 886.52 886.52"><path class="cls-1" d="M443.26,886.52c-59.82,0-117.87-11.73-172.55-34.85-52.79-22.33-100.19-54.28-140.88-94.97-40.69-40.69-72.65-88.09-94.97-140.88C11.73,561.13,0,503.08,0,443.26s11.73-117.87,34.85-172.55c22.33-52.79,54.28-100.19,94.97-140.88,40.69-40.69,88.09-72.65,140.88-94.97C325.39,11.73,383.44,0,443.26,0s117.87,11.73,172.55,34.85c52.79,22.33,100.19,54.28,140.88,94.97,40.69,40.69,72.65,88.09,94.97,140.88,23.13,54.68,34.85,112.73,34.85,172.55s-11.73,117.87-34.85,172.55c-22.33,52.79-54.28,100.19-94.97,140.88s-88.09,72.65-140.88,94.97c-54.68,23.13-112.73,34.85-172.55,34.85ZM493.26,103.63v679.26c165.66-24.28,293.26-167.34,293.26-339.63S658.92,127.91,493.26,103.63ZM393.26,103.63C227.6,127.91,100,270.97,100,443.26s127.6,315.34,293.26,339.63V103.63Z"/></svg>';
            }
            return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><path class="st0" d="M443.3,886.5c-59.8,0-117.9-11.7-172.6-34.9c-52.8-22.3-100.2-54.3-140.9-95c-40.7-40.7-72.6-88.1-95-140.9C11.7,561.1,0,503.1,0,443.3s11.7-117.9,34.9-172.6c22.3-52.8,54.3-100.2,95-140.9c40.7-40.7,88.1-72.6,140.9-95C325.4,11.7,383.4,0,443.3,0s117.9,11.7,172.6,34.9c52.8,22.3,100.2,54.3,140.9,95c40.7,40.7,72.6,88.1,95,140.9c23.1,54.7,34.9,112.7,34.9,172.6s-11.7,117.9-34.9,172.6c-22.3,52.8-54.3,100.2-95,140.9s-88.1,72.6-140.9,95C561.1,874.8,503.1,886.5,443.3,886.5z M443.3,100C254,100,100,254,100,443.3c0,189.3,154,343.3,343.3,343.3c189.3,0,343.3-154,343.3-343.3C786.5,254,632.5,100,443.3,100z M443.3,691c-66.2,0-128.4-25.8-175.2-72.6c-46.8-46.8-72.6-109-72.6-175.2c0-66.2,25.8-128.4,72.6-175.2c46.8-46.8,109-72.6,175.2-72.6c66.2,0,128.4,25.8,175.2,72.6c46.8,46.8,72.6,109,72.6,175.2s-25.8,128.4-72.6,175.2S509.4,691,443.3,691z M443.3,295.5c-81.5,0-147.8,66.3-147.8,147.8c0,81.5,66.3,147.8,147.8,147.8S591,524.7,591,443.2C591,361.7,524.7,295.5,443.3,295.5z"/></svg>';
        case 'Thunderstorm':
            return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><path class="st0" d="M851.7,270.7c-22.3-52.8-54.3-100.2-95-140.9c-40.7-40.7-88.1-72.6-140.9-95C561.1,11.7,503.1,0,443.3,0S325.4,11.7,270.7,34.9c-52.8,22.3-100.2,54.3-140.9,95s-72.6,88.1-95,140.9C11.7,325.4,0,383.4,0,443.3s11.7,117.9,34.9,172.6c22.3,52.8,54.3,100.2,95,140.9c40.7,40.7,88.1,72.6,140.9,95c54.7,23.1,112.7,34.9,172.6,34.9s117.9-11.7,172.6-34.9c52.8-22.3,100.2-54.3,140.9-95c40.7-40.7,72.6-88.1,95-140.9c23.1-54.7,34.9-112.7,34.9-172.6S874.8,325.4,851.7,270.7z M443.3,100c189.1,0,343,153.7,343.3,342.8H100C100.3,253.7,254.2,100,443.3,100z"/></svg>';
        case 'Rain':
            return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><path class="st0" d="M851.7,270.7c-22.3-52.8-54.3-100.2-95-140.9c-40.7-40.7-88.1-72.6-140.9-95C561.1,11.7,503.1,0,443.3,0S325.4,11.7,270.7,34.9c-52.8,22.3-100.2,54.3-140.9,95s-72.6,88.1-95,140.9C11.7,325.4,0,383.4,0,443.3s11.7,117.9,34.9,172.6c22.3,52.8,54.3,100.2,95,140.9c40.7,40.7,88.1,72.6,140.9,95c54.7,23.1,112.7,34.9,172.6,34.9s117.9-11.7,172.6-34.9c52.8-22.3,100.2-54.3,140.9-95c40.7-40.7,72.6-88.1,95-140.9c23.1-54.7,34.9-112.7,34.9-172.6S874.8,325.4,851.7,270.7z"/></svg>';
        case 'Snow':
            return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><path class="st0" d="M851.7,270.7c-22.3-52.8-54.3-100.2-95-140.9c-40.7-40.7-88.1-72.6-140.9-95C561.1,11.7,503.1,0,443.3,0S325.4,11.7,270.7,34.9c-52.8,22.3-100.2,54.3-140.9,95s-72.6,88.1-95,140.9C11.7,325.4,0,383.4,0,443.3s11.7,117.9,34.9,172.6c22.3,52.8,54.3,100.2,95,140.9c40.7,40.7,88.1,72.6,140.9,95c54.7,23.1,112.7,34.9,172.6,34.9s117.9-11.7,172.6-34.9c52.8-22.3,100.2-54.3,140.9-95c40.7-40.7,72.6-88.1,95-140.9c23.1-54.7,34.9-112.7,34.9-172.6S874.8,325.4,851.7,270.7z M564,493.3h218.9c-8.4,57.4-31,110.1-64.2,154.7L564,493.3z M167.9,647.9c-33.2-44.5-55.8-97.3-64.2-154.7h218.9L167.9,647.9z M322.6,393.3H103.7c8.4-57.4,31-110.2,64.2-154.7L322.6,393.3z M563.9,393.3l154.7-154.7c33.2,44.5,55.8,97.3,64.2,154.7H563.9z M443.3,100c76.6,0,147.5,25.3,204.7,67.9L443.3,372.5L238.6,167.9C295.8,125.3,366.6,100,443.3,100z M443.3,786.5c-76.6,0-147.5-25.3-204.7-67.9l204.7-204.7L648,718.6C590.8,761.3,519.9,786.5,443.3,786.5z"/></svg>';
        case 'Mist':
            return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><g><path class="st0" d="M851.7,270.7c-22.3-52.8-54.3-100.2-95-140.9c-40.7-40.7-88.1-72.6-140.9-95C561.1,11.7,503.1,0,443.3,0S325.4,11.7,270.7,34.9c-52.8,22.3-100.2,54.3-140.9,95s-72.6,88.1-95,140.9C11.7,325.4,0,383.4,0,443.3s11.7,117.9,34.9,172.6c22.3,52.8,54.3,100.2,95,140.9c40.7,40.7,88.1,72.6,140.9,95c54.7,23.1,112.7,34.9,172.6,34.9s117.9-11.7,172.6-34.9c52.8-22.3,100.2-54.3,140.9-95c40.7-40.7,72.6-88.1,95-140.9c23.1-54.7,34.9-112.7,34.9-172.6S874.8,325.4,851.7,270.7zM443.3,786.5C254,786.5,100,632.5,100,443.3C100,254,254,100,443.3,100c189.3,0,343.3,154,343.3,343.3C786.5,632.5,632.5,786.5,443.3,786.5z"/><path class="st0" d="M443.3,188.9c-67.9,0-131.8,26.5-179.9,74.5c-48,48-74.5,111.9-74.5,179.9s26.5,131.8,74.5,179.9c48,48,111.9,74.5,179.9,74.5s131.8-26.5,179.9-74.5c48-48,74.5-111.9,74.5-179.9s-26.5-131.8-74.5-179.9C575.1,215.4,511.2,188.9,443.3,188.9z"/></g></svg>';
        case 'Smoke':
            return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><g><path class="st0" d="M851.7,270.7c-22.3-52.8-54.3-100.2-95-140.9c-40.7-40.7-88.1-72.6-140.9-95C561.1,11.7,503.1,0,443.3,0S325.4,11.7,270.7,34.9c-52.8,22.3-100.2,54.3-140.9,95s-72.6,88.1-95,140.9C11.7,325.4,0,383.4,0,443.3s11.7,117.9,34.9,172.6c22.3,52.8,54.3,100.2,95,140.9c40.7,40.7,88.1,72.6,140.9,95c54.7,23.1,112.7,34.9,172.6,34.9s117.9-11.7,172.6-34.9c52.8-22.3,100.2-54.3,140.9-95c40.7-40.7,72.6-88.1,95-140.9c23.1-54.7,34.9-112.7,34.9-172.6S874.8,325.4,851.7,270.7zM443.3,786.5C254,786.5,100,632.5,100,443.3C100,254,254,100,443.3,100c189.3,0,343.3,154,343.3,343.3C786.5,632.5,632.5,786.5,443.3,786.5z"/><path class="st0" d="M443.3,352.4c-31-52.1-87.9-87-152.8-87c-98,0-177.8,79.8-177.8,177.8c0,98,79.8,177.8,177.8,177.8c64.9,0,121.7-34.9,152.8-87c31,52.1,87.9,87,152.8,87c98,0,177.8-79.8,177.8-177.8s-79.8-177.8-177.8-177.8C531.2,265.5,474.3,300.4,443.3,352.4z M290.5,571c-70.5,0-127.8-57.3-127.8-127.8c0-70.5,57.3-127.8,127.8-127.8s127.8,57.3,127.8,127.8C418.3,513.7,360.9,571,290.5,571z M723.9,443.3c0,70.5-57.3,127.8-127.8,127.8c-70.5,0-127.8-57.3-127.8-127.8c0-70.5,57.3-127.8,127.8-127.8C666.5,315.5,723.9,372.8,723.9,443.3z"/></g></svg>';
        case 'Dust':
            return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 886.52 886.52"><path class="cls-1" d="M851.67,270.71c-22.33-52.79-54.28-100.19-94.97-140.88-40.69-40.69-88.09-72.65-140.88-94.97C561.13,11.73,503.08,0,443.26,0s-117.87,11.73-172.55,34.85c-52.79,22.33-100.19,54.28-140.88,94.97s-72.65,88.09-94.97,140.88C11.73,325.39,0,383.44,0,443.26s11.73,117.87,34.85,172.55c22.33,52.79,54.28,100.19,94.97,140.88,40.69,40.69,88.09,72.65,140.88,94.97,54.68,23.13,112.73,34.85,172.55,34.85s117.87-11.73,172.55-34.85c52.79-22.33,100.19-54.28,140.88-94.97,40.69-40.69,72.65-88.09,94.97-140.88,23.13-54.68,34.85-112.73,34.85-172.55s-11.73-117.87-34.85-172.55ZM443.26,786.52c-189.27,0-343.26-153.99-343.26-343.26S253.99,100,443.26,100s343.26,153.99,343.26,343.26-153.99,343.26-343.26,343.26Z"/><path class="cls-1" d="M443.27,162.64c70.47,0,127.8,57.33,127.8,127.8h50c0-98.04-79.76-177.8-177.8-177.8s-177.8,79.76-177.8,177.8,79.75,177.79,177.78,177.8h0c70.47,0,127.8,57.34,127.8,127.81s-57.33,127.8-127.8,127.8-127.8-57.33-127.8-127.8h-50c0,98.04,79.76,177.8,177.8,177.8s177.8-79.76,177.8-177.8c0-1.88-.04-3.74-.1-5.61-.08-2.7-.22-5.39-.42-8.05-.03-.43-.08-.85-.11-1.28-.09-1.07-.18-2.15-.29-3.21,0-.06-.01-.12-.02-.18-8.59-83.49-75.19-150.04-158.7-158.54-.21-.02-.42-.04-.63-.06-1.28-.13-2.57-.25-3.86-.34-.27-.02-.54-.03-.82-.05-1.23-.09-2.47-.17-3.71-.24-.48-.02-.96-.03-1.44-.05-1.04-.04-2.07-.09-3.11-.12-.74-.02-1.48-.02-2.21-.03-.79-.01-1.57-.03-2.36-.03h0c-70.47,0-127.8-57.34-127.8-127.81s57.33-127.8,127.8-127.8Z"/></svg>';
        case 'Sand':
            return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 886.5 886.5" style="enable-background:new 0 0 886.5 886.5;" xml:space="preserve"><g><path class="st0" d="M851.7,270.7c-22.3-52.8-54.3-100.2-95-140.9c-40.7-40.7-88.1-72.6-140.9-95C561.1,11.7,503.1,0,443.3,0S325.4,11.7,270.7,34.9c-52.8,22.3-100.2,54.3-140.9,95s-72.6,88.1-95,140.9C11.7,325.4,0,383.4,0,443.3s11.7,117.9,34.9,172.6c22.3,52.8,54.3,100.2,95,140.9c40.7,40.7,88.1,72.6,140.9,95c54.7,23.1,112.7,34.9,172.6,34.9s117.9-11.7,172.6-34.9c52.8-22.3,100.2-54.3,140.9-95c40.7-40.7,72.6-88.1,95-140.9c23.1-54.7,34.9-112.7,34.9-172.6S874.8,325.4,851.7,270.7zM443.3,786.5C254,786.5,100,632.5,100,443.3C100,254,254,100,443.3,100c189.3,0,343.3,154,343.3,343.3C786.5,632.5,632.5,786.5,443.3,786.5z"/><path class="st0" d="M635.6,387.5l30.7,30.7H443.3v0c-70.5,0-127.8-57.3-127.8-127.8s57.3-127.8,127.8-127.8S571.1,220,571.1,290.4h50c0-98-79.8-177.8-177.8-177.8c-98,0-177.8,79.8-177.8,177.8c0,50.1,20.9,95.5,54.3,127.8H157.6v50h285.6c70.5,0,127.8,57.3,127.8,127.8s-57.3,127.8-127.8,127.8c-70.5,0-127.8-57.3-127.8-127.8h-50c0,98,79.8,177.8,177.8,177.8S621,694.1,621,596c0-1.9,0-3.7-0.1-5.6c-0.1-2.7-0.2-5.4-0.4-8.1c0-0.4-0.1-0.9-0.1-1.3c-0.1-1.1-0.2-2.1-0.3-3.2c0-0.1,0-0.1,0-0.2c-4.4-42.8-24-81.1-53.4-109.5h99.6L635.6,499l35.4,35.4l91.1-91.1L671,352.2L635.6,387.5z"/></g></svg>';
        default:
            return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 886.52 886.52"><path class="cls-1" d="M851.66,270.71c-22.33-52.79-54.28-100.19-94.97-140.88-40.69-40.69-88.09-72.65-140.88-94.97C561.13,11.73,503.08,0,443.26,0s-117.87,11.73-172.55,34.85c-52.79,22.33-100.19,54.28-140.88,94.97-40.69,40.69-72.65,88.09-94.97,140.88C11.73,325.39,0,383.44,0,443.26s11.73,117.87,34.85,172.55c22.33,52.79,54.28,100.19,94.97,140.88,40.69,40.69,88.09,72.65,140.88,94.97,54.68,23.13,112.73,34.85,172.55,34.85s117.87-11.73,172.55-34.85c52.79-22.33,100.19-54.28,140.88-94.97,40.69-40.69,72.65-88.09,94.97-140.88,23.13-54.68,34.85-112.73,34.85-172.55s-11.73-117.87-34.85-172.55ZM443.26,100c76.63,0,147.48,25.25,204.67,67.86l-204.67,204.67-204.67-204.67c57.19-42.61,128.03-67.86,204.67-67.86ZM100,443.26c0-76.65,25.26-147.5,67.88-204.69l204.67,204.67-204.69,204.69c-42.61-57.19-67.86-128.03-67.86-204.67ZM443.26,786.52c-76.65,0-147.5-25.26-204.69-67.88l204.69-204.69,204.69,204.69c-57.19,42.62-128.05,67.88-204.69,67.88ZM718.66,647.92l-204.69-204.69,204.67-204.67c42.62,57.19,67.88,128.05,67.88,204.69s-25.25,147.48-67.86,204.67Z"/></svg>';
    }
}

let weatherArray = [];
let temperatureArray = [];
let timeArray = [];

async function fetchWeather() {
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        // 天気情報の処理
        const weatherData = data.hourly;

        // 配列に時間と天気情報を格納する処理
        for (let i = 0; i < 24; i += 3) {
            const date = new Date(weatherData[i].dt * 1000).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
            const morningWeather = convertWeatherToSVG(weatherData[i].weather[0].main, weatherData[i].weather[0].description);
            const temperature = weatherData[i].temp;

            // 時間を timeArray に追加
            timeArray.push(date);

            // 天気情報を weatherArray に追加
            weatherArray.push(morningWeather);

            // 気温を temperatureArray に追加
            temperatureArray.push(temperature);
        }

        // 天気情報を表示する処理
        const cityContainer = document.getElementById('city-container');
        const cityElement = document.createElement('h1');
        cityElement.innerHTML = 'Tokyo';
        cityContainer.appendChild(cityElement);

        displayWeatherInfo(timeArray, weatherArray, temperatureArray);
        drawChart(timeArray, temperatureArray);
        weatherDisplay(weatherArray);
        document.getElementById('bottom-contents').style.display = 'flex';
    } catch (error) {
        console.log('Error fetching weather data:', error);
    }
}

function displayWeatherInfo(timeArray, weatherArray, temperatureArray) {
    console.log('Time Array:', timeArray);
    console.log('Weather Array:', weatherArray);
    console.log('Temperature Array:', temperatureArray);
}

function drawChart(timeArray, temperatureArray) {
    const mydata = {
        labels: timeArray,
        datasets: [{
            label: 'キオン',
            data: temperatureArray,
            borderColor: '#ffffff',
        }]
    };

    new Chart(document.getElementById('stage'), {
        type: 'line',
        data: mydata,
        options: {
            scales: {
                x: {
                    display: true,
                    ticks: {
                        color: '#85888b', // X軸のラベルの色を白に設定
                    },
                    grid : {
                        display : true,
                        color: '#85888b', // X軸のグリッドの色を白に設定
                    }
                },
                y: {
                    display: true,
                    ticks: {
                        color: '#85888b', // Y軸のラベルの色を白に設定
                    },
                    grid : {
                        display : true,
                        color: '#85888b', // X軸のグリッドの色を白に設定
                    },
                    grace: "10%",
                    scaleLabel: {
                        display: window.screen.width > 414,
                        //省略
                    },
                },
        },
        plugins: {
            legend: {
                display: false // 凡例を表示しない
            },
        },
        maintainAspectRatio: true, // グラフが画面に収まるようにする
        }
    });
}

function weatherDisplay(weatherArray) {
    const weatherContainer = document.getElementById('weather-container');
    for (let i = 0; i < weatherArray.length; i++) {
        const weatherItem = document.createElement('div');
        weatherItem.classList.add("weather-item", `item${i}`);
        const weatherElement = document.createElement('p');
        weatherElement.innerHTML = weatherArray[i];
        weatherItem.appendChild(weatherElement);
        weatherContainer.appendChild(weatherItem);
    }
    const lineContainer = document.getElementById('svg-line');
    const lineItem = document.createElement('div');
    lineItem.classList.add("line");
    const lineElement = document.createElement('p');
    lineElement.innerHTML = '<svg class="line" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 891.67 108.87"><defs><style>.cls-1 {fill: #ffffff;}.cls-1,.cls-2 {stroke: #ffffff;stroke-miterlimit: 10;}.cls-2 {fill: none; stroke-width: 20px;}</style></defs><polyline class="cls-2" points="63.82 49.89 823.85 49.89 885.62 96.8" /><circle class="cls-1" cx="50.66" cy="50.66" r="50.16" /><line class="cls-2" x1="165.09" y1="49.75" x2="223.92" y2="96.7" /><line class="cls-2" x1="352.53" y1="49.85" x2="411.35" y2="96.8" /><line class="cls-2" x1="258.81" y1="49.75" x2="317.64" y2="96.7" /><line class="cls-2" x1="539.96" y1="49.8" x2="598.79" y2="96.75" /><line class="cls-2" x1="446.24" y1="49.7" x2="505.07" y2="96.65" /><line class="cls-2" x1="539.96" y1="49.85" x2="598.79" y2="96.8" /><line class="cls-2" x1="727.39" y1="49.8" x2="786.22" y2="96.75" /><line class="cls-2" x1="633.68" y1="49.7" x2="692.5" y2="96.65" /></svg>'
    lineItem.appendChild(lineElement);
    lineContainer.appendChild(lineItem);
}

// ページが読み込まれた際に天気情報を取得する
window.onload = fetchWeather;